#include <Arduino.h>
#include "RSA.h"

const unsigned long interval_us = 3000;   // Intervalo en microsegundos

//Clave publica (e,n)
//Clave privada (d,n)
unsigned long e = 11;
unsigned long d = 568659191;
unsigned long n = 2502200483;

// Cifrar el mensaje
/*
unsigned long long encrypted_message[16] = {
  346509732ULL, 285511028ULL, 2311497964ULL, 2271317071ULL, 180059248ULL, 657641196ULL, 1046204852ULL, 1225433528ULL, 2405354568ULL, 2485228321ULL, 1441092969ULL, 85152954ULL, 1467350252ULL, 828680304ULL, 1134165027ULL, 1395465467ULL
};
*/

unsigned long long encrypted_message[64] = {
  346509732ULL, 285511028ULL, 2311497964ULL, 2271317071ULL, 180059248ULL, 657641196ULL, 1046204852ULL, 1225433528ULL, 2405354568ULL, 2485228321ULL, 1441092969ULL, 85152954ULL, 1467350252ULL, 828680304ULL, 1134165027ULL, 1395465467ULL,
  346509732ULL, 285511028ULL, 2311497964ULL, 2271317071ULL, 180059248ULL, 657641196ULL, 1046204852ULL, 1225433528ULL, 2405354568ULL, 2485228321ULL, 1441092969ULL, 85152954ULL, 1467350252ULL, 828680304ULL, 1134165027ULL, 1395465467ULL,
  346509732ULL, 285511028ULL, 2311497964ULL, 2271317071ULL, 180059248ULL, 657641196ULL, 1046204852ULL, 1225433528ULL, 2405354568ULL, 2485228321ULL, 1441092969ULL, 85152954ULL, 1467350252ULL, 828680304ULL, 1134165027ULL, 1395465467ULL,
  346509732ULL, 285511028ULL, 2311497964ULL, 2271317071ULL, 180059248ULL, 657641196ULL, 1046204852ULL, 1225433528ULL, 2405354568ULL, 2485228321ULL, 1441092969ULL, 85152954ULL, 1467350252ULL, 828680304ULL, 1134165027ULL, 1395465467ULL
};

/*
unsigned long long encrypted_message[128] = {
  346509732ULL, 285511028ULL, 2311497964ULL, 2271317071ULL, 180059248ULL, 657641196ULL, 1046204852ULL, 1225433528ULL, 2405354568ULL, 2485228321ULL, 1441092969ULL, 85152954ULL, 1467350252ULL, 828680304ULL, 1134165027ULL, 1395465467ULL,
  346509732ULL, 285511028ULL, 2311497964ULL, 2271317071ULL, 180059248ULL, 657641196ULL, 1046204852ULL, 1225433528ULL, 2405354568ULL, 2485228321ULL, 1441092969ULL, 85152954ULL, 1467350252ULL, 828680304ULL, 1134165027ULL, 1395465467ULL,
  346509732ULL, 285511028ULL, 2311497964ULL, 2271317071ULL, 180059248ULL, 657641196ULL, 1046204852ULL, 1225433528ULL, 2405354568ULL, 2485228321ULL, 1441092969ULL, 85152954ULL, 1467350252ULL, 828680304ULL, 1134165027ULL, 1395465467ULL,
  346509732ULL, 285511028ULL, 2311497964ULL, 2271317071ULL, 180059248ULL, 657641196ULL, 1046204852ULL, 1225433528ULL, 2405354568ULL, 2485228321ULL, 1441092969ULL, 85152954ULL, 1467350252ULL, 828680304ULL, 1134165027ULL, 1395465467ULL,
  346509732ULL, 285511028ULL, 2311497964ULL, 2271317071ULL, 180059248ULL, 657641196ULL, 1046204852ULL, 1225433528ULL, 2405354568ULL, 2485228321ULL, 1441092969ULL, 85152954ULL, 1467350252ULL, 828680304ULL, 1134165027ULL, 1395465467ULL,
  346509732ULL, 285511028ULL, 2311497964ULL, 2271317071ULL, 180059248ULL, 657641196ULL, 1046204852ULL, 1225433528ULL, 2405354568ULL, 2485228321ULL, 1441092969ULL, 85152954ULL, 1467350252ULL, 828680304ULL, 1134165027ULL, 1395465467ULL,
  346509732ULL, 285511028ULL, 2311497964ULL, 2271317071ULL, 180059248ULL, 657641196ULL, 1046204852ULL, 1225433528ULL, 2405354568ULL, 2485228321ULL, 1441092969ULL, 85152954ULL, 1467350252ULL, 828680304ULL, 1134165027ULL, 1395465467ULL,
  346509732ULL, 285511028ULL, 2311497964ULL, 2271317071ULL, 180059248ULL, 657641196ULL, 1046204852ULL, 1225433528ULL, 2405354568ULL, 2485228321ULL, 1441092969ULL, 85152954ULL, 1467350252ULL, 828680304ULL, 1134165027ULL, 1395465467ULL
};
*/

const int length = 64;
char decrypted_message[length + 1];

RSA rsa;

// Función principal de Arduino
void setup() {
  Serial.begin(115200);
  //while (!Serial);
}

void loop() {
  /*
  for (int i = 0; i < 10; i++) {
    rsa.decrypt_message(encrypted_message, length, d, n, decrypted_message);
  }
  */

  rsa.decrypt_message(encrypted_message, length, d, n, decrypted_message);

  /*
  Serial.println("\nMensaje descifrado:");
  Serial.println(decrypted_message);
  */

  // Espera fija de en µs
  delayMicroseconds(interval_us);
}